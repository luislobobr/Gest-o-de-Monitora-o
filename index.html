<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Carla Borges - Sistema de Gestão v3.0</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="loading-overlay" id="initial-loading">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem; --bs-spinner-border-width: 0.3rem; color: var(--cor-principal) !important;">
        <span class="visually-hidden">Carregando...</span>
    </div>
</div>

<div id="login-section" class="container">
    <div class="card p-4 p-md-5">
        <h3 class="text-center mb-4">Login - Studio Carla Borges</h3>
        <form id="login-form">
            <div class="mb-3">
                <label for="login-email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="login-email" required>
            </div>
            <div class="mb-3">
                <label for="login-password" class="form-label">Senha</label>
                <input type="password" class="form-control" id="login-password" required>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Entrar</button>
            </div>
            <div id="login-error" class="text-danger mt-3 text-center" style="display: none;"></div>
        </form>
    </div>
</div>


<div id="main-app-section">
    <div id="user-info" class="text-muted">
        Logado como: <span id="user-email"></span><br>
        <button id="logout-button" class="btn btn-sm btn-outline-secondary mt-1">Sair</button>
    </div>

    <div class="container-app mt-4 mb-5">
        
        <img id="app-logo" src="https://placehold.co/200x80/4A90E2/FFFFFF?text=Sua+Logo+Aqui" alt="Logomarca Studio Carla Borges" onerror="this.src='https://placehold.co/200x80/cccccc/FFFFFF?text=Logo'; this.onerror=null;">

        <div class="text-center mb-5">
            <h2 style="font-size: 2.5rem; color: var(--cor-titulo);">Studio Carla Borges</h2>
            <p class="text-muted" style="font-size: 1.1rem;">Sistema de Gestão</p>
        </div>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation"><button class="nav-link active" id="inicio-tab" data-bs-toggle="tab" data-bs-target="#inicio-pane" type="button">Início</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="financeiro-tab" data-bs-toggle="tab" data-bs-target="#financeiro-pane" type="button">Financeiro</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="caixa-tab" data-bs-toggle="tab" data-bs-target="#caixa-pane" type="button">Controle de Caixa</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="alunos-tab" data-bs-toggle="tab" data-bs-target="#alunos-pane" type="button">Alunos</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="aulas-tab" data-bs-toggle="tab" data-bs-target="#aulas-pane" type="button">Aulas</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config-pane" type="button">Configurações</button></li>
        </ul>

        <div class="tab-content" id="myTabContent">
            
            <div class="tab-pane fade show active" id="inicio-pane" role="tabpanel">
                <div class="card border-top-0 rounded-0 rounded-bottom"><div class="card-body p-4 p-md-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="card-title mb-0">Programação do Dia</h5>
                        <h6 class="mb-0" id="dia-da-semana-titulo"></h6>
                    </div>
                    <div id="programacao-do-dia"><p class="text-center p-5">Carregando programação...</p></div>
                </div></div>
            </div>
            
            <div class="tab-pane fade" id="financeiro-pane" role="tabpanel">
                <div class="card border-top-0 rounded-0 rounded-bottom"><div class="card-body p-4 p-md-5">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
                        <h5 class="card-title mb-0">Dashboard Financeiro</h5>
                        <h6 id="mes-ano-financeiro" class="text-muted fw-normal"></h6>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-lg col-md-6 mb-3"><div class="card summary-card summary-card-success h-100"><div class="card-body"><h6 class="card-subtitle text-muted text-uppercase small">Receita (Aulas)</h6><span class="h4" id="resumo-receita-aulas">R$ 0,00</span></div></div></div>
                        <div class="col-lg col-md-6 mb-3"><div class="card summary-card summary-card-success h-100"><div class="card-body"><h6 class="card-subtitle text-muted text-uppercase small">Receita (Matrículas)</h6><span class="h4" id="resumo-receita-matriculas">R$ 0,00</span></div></div></div>
                        <div class="col-lg col-md-6 mb-3"><div class="card summary-card summary-card-info h-100"><div class="card-body"><h6 class="card-subtitle text-muted text-uppercase small">Outras Entradas</h6><span class="h4" id="resumo-outras-entradas">R$ 0,00</span></div></div></div>
                        <div class="col-lg col-md-6 mb-3"><div class="card summary-card summary-card-danger h-100"><div class="card-body"><h6 class="card-subtitle text-muted text-uppercase small">Total Despesas</h6><span class="h4" id="resumo-despesas">R$ 0,00</span></div></div></div>
                        <div class="col-lg col-md-6 mb-3"><div class="card summary-card summary-card-primary h-100"><div class="card-body"><h6 class="card-subtitle text-muted text-uppercase small">Balanço do Mês</h6><span class="h4" id="resumo-balanco">R$ 0,00</span></div></div></div>
                        <div class="col-lg col-md-6 mb-3"><div class="card summary-card summary-card-warning h-100"><div class="card-body"><h6 class="card-subtitle text-muted text-uppercase small">A Receber (Alunos) <span id="alert-badge-a-receber" class="badge bg-danger rounded-pill alert-badge" style="display: none;">!</span></h6><span class="h4" id="resumo-a-receber">R$ 0,00</span></div></div></div>
                    </div>

                    <hr class="my-5">

                    <div class="row">
                        <div class="col-lg-6 mb-4 mb-lg-0">
                            <h5 class="mb-3">Análise Financeira</h5>
                            <div class="card mb-3"><div class="card-body"><p class="card-text">Selecione o período para gerar um balancete detalhado.</p><div class="row g-2 align-items-end"><div class="col"><label for="relatorio-mes">Mês</label><select id="relatorio-mes" class="form-select"></select></div><div class="col"><label for="relatorio-ano">Ano</label><select id="relatorio-ano" class="form-select"></select></div><div class="col-auto"><button class="btn btn-primary" id="btn-gerar-balancete">Gerar PDF</button></div></div></div></div>
                            <div class="card"><div class="card-body"><p class="card-text">Gere um relatório focado nos alunos com pagamentos pendentes.</p><button class="btn btn-warning" id="btn-gerar-relatorio-inadimplencia">Relatório de Inadimplência (PDF)</button></div></div>
                        </div>
                        <div class="col-lg-6">
                            <h5 class="mb-3">Previsão de Receita (Alunos)</h5>
                            <div class="table-responsive"><table class="table table-sm table-bordered"><thead class="table-light"><tr><th>Mês</th><th>Previsão</th></tr></thead><tbody id="tabela-previsao"></tbody></table></div>
                        </div>
                    </div>
                    
                    <hr class="my-5">

                    <h5 class="card-title mb-4">Gestão de Mensalidades</h5>
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
                        <div class="btn-group" role="group" id="filtros-financeiro"><button type="button" class="btn btn-outline-secondary active" data-filtro="todos">Todos</button><button type="button" class="btn btn-outline-secondary" data-filtro="pendente">Pendentes</button><button type="button" class="btn btn-outline-secondary" data-filtro="pago">Pagos</button><button type="button" class="btn btn-outline-secondary" data-filtro="atrasado">Atrasados</button></div>
                        <div><button class="btn btn-primary btn-sm" id="btn-gerar-mensalidades">Verificar e Gerar Mensalidades</button></div>
                    </div>
                    <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Aluno / Descrição</th><th>Vencimento</th><th>Valor</th><th>Status</th><th>Ações</th></tr></thead><tbody id="tabela-financeiro"></tbody></table></div>

                </div></div>
            </div>
            
            <div class="tab-pane fade" id="caixa-pane" role="tabpanel">
                 <div class="card border-top-0 rounded-0 rounded-bottom"><div class="card-body p-4 p-md-5">
                    <h5 class="card-title mb-4">Lançamentos de Caixa</h5>
                    <form id="form-caixa" class="row g-3 align-items-end mb-4">
                        <input type="hidden" id="caixa-id">
                        <div class="col-sm-3"><label class="form-label">Descrição</label><input type="text" id="caixa-descricao" class="form-control" required></div>
                        <div class="col-sm-2"><label class="form-label">Valor (R$)</label><input type="number" step="0.01" id="caixa-valor" class="form-control" required min="0.01"></div>
                        <div class="col-sm-2"><label class="form-label">Data</label><input type="date" id="caixa-data" class="form-control" required></div>
                        <div class="col-sm-2"><label class="form-label">Categoria</label><input type="text" id="caixa-categoria" class="form-control" list="categorias-list" placeholder="Ex: Aluguel, Venda"></div>
                        <div class="col-sm-1"><label class="form-label">Tipo</label><select id="caixa-tipo" class="form-select" required><option value="entrada">Entrada</option><option value="saida">Saída</option></select></div>
                        <div class="col-sm-2"><button type="submit" class="btn btn-primary w-100">Lançar</button></div>
                        <div class="col-12"><button type="button" id="btn-cancelar-edicao-caixa" class="btn btn-secondary" style="display: none;">Cancelar Edição</button></div>
                    </form>
                    <hr class="my-4">
                    <h6 class="mb-3">Histórico de Lançamentos</h6>
                    <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Descrição</th><th>Categoria</th><th>Data</th><th>Tipo</th><th>Valor</th><th>Ações</th></tr></thead><tbody id="tabela-caixa"></tbody></table></div>
                    <datalist id="categorias-list"><option value="Aluguel"><option value="Água"><option value="Luz"><option value="Internet"><option value="Material de Limpeza"><option value="Material de Escritório"><option value="Venda de Produto"><option value="Aula Avulsa"><option value="Outros"></datalist>
                </div></div>
            </div>

            <div class="tab-pane fade" id="alunos-pane" role="tabpanel">
                <div class="card border-top-0 rounded-0 rounded-bottom"><div class="card-body p-4 p-md-5">
                    <h5 class="card-title mb-4" id="alunos-card-title">Cadastro de Alunos</h5>
                    <form id="form-aluno">
                        <input type="hidden" id="aluno-id">
                        <div class="row">
                            <div class="col-md-5 mb-3"><label class="form-label">Nome Completo</label><input type="text" id="aluno-nome" class="form-control" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Telefone</label><input type="tel" id="aluno-telefone" class="form-control" placeholder="(31) 99999-9999" pattern="\([0-9]{2}\) [0-9]{5}-[0-9]{4}" title="Formato: (XX) XXXXX-XXXX"></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Dia Vencimento</label><input type="number" id="aluno-dia-vencimento" class="form-control" min="1" max="31" value="10" required></div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3"><label class="form-label">Turma</label><select id="aluno-turma" class="form-select" required><option selected disabled value="">Selecione...</option></select></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Plano de Pagamento</label><select id="aluno-plano" class="form-select" required><option selected disabled value="">Selecione...</option></select></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Bolsa de Estudo</label><select id="aluno-bolsa" class="form-select"><option value="0" selected>Não é bolsista</option><option value="10">Bolsista 10%</option><option value="20">Bolsista 20%</option><option value="50">Bolsista 50%</option><option value="100">Bolsista 100%</option></select></div>
                        </div>
                        <div class="row align-items-end">
                            <div class="col-md-4 mb-3"><label class="form-label">Valor da Matrícula (R$)</label><input type="number" step="0.01" id="aluno-matricula-valor" class="form-control" value="100.00" min="0"></div>
                            <div class="col-md-4 mb-3"><div class="form-check pt-4"><input class="form-check-input" type="checkbox" id="aluno-matricula-isento"><label class="form-check-label" for="aluno-matricula-isento">Isento de Matrícula</label></div></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Aluno</button>
                        <button type="button" class="btn btn-secondary" id="btn-cancelar-edicao-aluno" style="display: none;">Cancelar</button>
                    </form>
                    <hr class="my-4">
                    <h6 class="mb-3">Alunos Cadastrados</h6>
                    <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Nome</th><th>Plano</th><th>Bolsa</th><th>Vencimento</th><th>Ações</th></tr></thead><tbody id="tabela-alunos"></tbody></table></div>
                </div></div>
            </div>

            <div class="tab-pane fade" id="aulas-pane" role="tabpanel">
                <div class="card border-top-0 rounded-0 rounded-bottom"><div class="card-body p-4 p-md-5">
                    <h5 class="card-title mb-4">Cadastro de Aulas e Horários</h5>
                    <form id="form-aula">
                        <input type="hidden" id="aula-id">
                        <div class="row">
                            <div class="col-md-6 mb-3"><label class="form-label">Nome da Turma</label><input type="text" id="aula-nome" class="form-control" required></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Horário</label><input type="time" id="aula-horario" class="form-control" required></div>
                            <div class="col-md-3 mb-3"><label class="form-label">Vagas</label><input type="number" id="aula-vagas" class="form-control" min="1" placeholder="Ilimitado"></div>
                        </div>
                        <div class="mb-3"><label class="form-label d-block">Dias da Semana</label>
                            <div id="aula-dias-semana">
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="seg" value="seg"><label class="form-check-label" for="seg">Seg</label></div>
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="ter" value="ter"><label class="form-check-label" for="ter">Ter</label></div>
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="qua" value="qua"><label class="form-check-label" for="qua">Qua</label></div>
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="qui" value="qui"><label class="form-check-label" for="qui">Qui</label></div>
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="sex" value="sex"><label class="form-check-label" for="sex">Sex</label></div>
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="sab" value="sab"><label class="form-check-label" for="sab">Sáb</label></div>
                                <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="dom" value="dom"><label class="form-check-label" for="dom">Dom</label></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Aula</button>
                        <button type="button" class="btn btn-secondary" id="btn-cancelar-edicao-aula" style="display: none;">Cancelar</button>
                    </form>
                    <hr class="my-4"><h6>Aulas Cadastradas</h6>
                    <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Turma</th><th>Horário</th><th>Dias</th><th>Vagas</th><th>Ações</th></tr></thead><tbody id="tabela-aulas"></tbody></table></div>
                </div></div>
            </div>
            
            <div class="tab-pane fade" id="config-pane" role="tabpanel">
                <div class="card border-top-0 rounded-0 rounded-bottom"><div class="card-body p-4 p-md-5">
                  <div class="row">
                      <div class="col-lg-8 mb-4 mb-lg-0">
                          <h5 class="card-title mb-3">Planos de Pagamento</h5>
                          <form id="form-plano" class="row g-2 align-items-end mb-3">
                              <input type="hidden" id="plano-id">
                              <div class="col-sm-4"><label class="form-label">Nome do Plano</label><input type="text" id="plano-nome" class="form-control" required></div>
                              <div class="col-sm-2"><label class="form-label">Valor Parcela</label><input type="number" step="0.01" id="plano-valor-parcela" class="form-control" min="0.01" required></div>
                              <div class="col-sm-2"><label class="form-label">Qtd. Parcelas</label><input type="number" id="plano-meses" class="form-control" required value="1" min="1"></div>
                              <div class="col-sm-2"><label class="form-label">Desconto (%)</label><input type="number" step="0.01" id="plano-desconto" class="form-control" placeholder="0" min="0" max="100"></div>
                              <div class="col-sm-2"><button type="submit" class="btn btn-primary w-100">Salvar</button></div>
                              <div class="col-sm-4 mt-3"><label class="form-label">Valor Total (c/ desc.)</label><input type="text" id="plano-valor-total-calculado" class="form-control" readonly></div>
                              <div class="col-12 mt-2"><button type="button" id="btn-cancelar-edicao-plano" class="btn btn-secondary" style="display:none;">Cancelar Edição</button></div>
                          </form>
                          <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Nome</th><th>Valor Parcela</th><th>Parcelas</th><th>Desconto</th><th>Total</th><th>Ações</th></tr></thead><tbody id="tabela-planos"></tbody></table></div>
                      </div>
                      <div class="col-lg-4">
                          <h5 class="card-title mb-3">Formas de Pagamento</h5>
                          <form id="form-formas-pagamento" class="row g-2 align-items-end mb-3">
                              <input type="hidden" id="forma-pagamento-id">
                              <div class="col"><label class="form-label">Nome da Forma</label><input type="text" id="forma-pagamento-nome" class="form-control" required></div>
                              <div class="col-auto"><button type="submit" class="btn btn-primary w-100">Salvar</button></div>
                              <div class="col-auto"><button type="button" id="btn-cancelar-edicao-forma-pagamento" class="btn btn-secondary w-100" style="display:none;">Cancelar</button></div>
                          </form>
                          <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Nome</th><th>Ações</th></tr></thead><tbody id="tabela-formas-pagamento"></tbody></table></div>
                      </div>
                  </div>
                </div></div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="modal-pagamento" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Lançar Pagamento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <form id="form-pagamento-lancamento">
        <input type="hidden" id="pagamento-mensalidade-id">
        <p>Lançamento para: <strong id="pagamento-aluno-nome"></strong></p>
        <div class="mb-3"><label class="form-label">Valor a Pagar (R$)</label><input type="number" step="0.01" class="form-control" id="pagamento-valor" required min="0.01"></div>
        <div class="mb-3"><label class="form-label">Desconto (R$)</label><input type="number" step="0.01" class="form-control" id="pagamento-desconto" placeholder="0.00" min="0"></div>
        <div class="mb-3"><label class="form-label">Valor Final (R$)</label><input type="number" step="0.01" class="form-control" id="pagamento-valor-final" readonly></div>
        <div class="mb-3"><label class="form-label">Data do Pagamento</label><input type="date" class="form-control" id="pagamento-data" required></div>
        <div class="mb-3"><label class="form-label">Forma de Pagamento</label><select class="form-select" id="pagamento-forma" required></select></div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-primary">Confirmar Pagamento</button></div>
      </form>
    </div>
  </div></div>
</div>

<div class="modal fade" id="confirmationModal" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title" id="confirmationModalTitle">Confirmar Ação</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body"><p id="confirmationModalBody">Você tem certeza que deseja prosseguir?</p></div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="button" class="btn btn-danger" id="confirmActionBtn">Confirmar</button></div>
    </div></div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header"><svg class="rounded me-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#007aff"></rect></svg><strong class="me-auto" id="toastTitle">Notificação</strong><button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button></div>
        <div class="toast-body" id="toastBody"></div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<script type="module" src="app.js"></script>

</body>
</html>